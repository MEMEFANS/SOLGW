<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSnake 私募</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #0c0521 0%, #1a0942 50%, #0c0521 100%);
            min-height: 100vh;
        }
        .gradient-border {
            border: 1px solid transparent;
            background: linear-gradient(#13091B, #13091B) padding-box,
                        linear-gradient(to right, #9945FF, #14F195) border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, rgba(153, 69, 255, 0.1), rgba(20, 241, 149, 0.1));
        }
    </style>
</head>
<body class="antialiased">

<div class="mt-16 text-center">
    <h2 class="text-4xl font-bold text-[#14F195] mb-8">距离私募结束还有</h2>
    <div class="max-w-3xl mx-auto gradient-bg backdrop-blur-sm rounded-xl p-8 sol-shadow">
        <!-- 倒计时 -->
        <div class="grid grid-cols-4 gap-4 mb-8">
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <div class="text-3xl font-bold text-[#14F195]" id="days">30</div>
                <div class="text-[#9945FF]">天</div>
            </div>
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <div class="text-3xl font-bold text-[#14F195]" id="hours">00</div>
                <div class="text-[#9945FF]">时</div>
            </div>
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <div class="text-3xl font-bold text-[#14F195]" id="minutes">00</div>
                <div class="text-[#9945FF]">分</div>
            </div>
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <div class="text-3xl font-bold text-[#14F195]" id="seconds">00</div>
                <div class="text-[#9945FF]">秒</div>
            </div>
        </div>

        <h2 class="text-2xl font-bold text-[#14F195] mb-6">参与私募</h2>
        
        <!-- 私募信息 -->
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <h3 class="text-[#9945FF] mb-2">私募价格</h3>
                <p class="text-xl text-[#14F195]">1 SOL = 10000 DSNK</p>
            </div>
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <h3 class="text-[#9945FF] mb-2">最低投资</h3>
                <p class="text-xl text-[#14F195]">0.1 SOL</p>
            </div>
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <h3 class="text-[#9945FF] mb-2">总发行量</h3>
                <p class="text-xl text-[#14F195]">100,000,000 DSNK</p>
            </div>
            <div class="gradient-border rounded-lg bg-[#13091B] p-4">
                <h3 class="text-[#9945FF] mb-2">私募比例</h3>
                <p class="text-xl text-[#14F195]">10%</p>
            </div>
        </div>

        <!-- 进度条 -->
        <div class="mb-8">
            <div class="flex justify-between mb-2">
                <span class="text-[#9945FF]">已募集</span>
                <span class="text-[#14F195]">500,000 / 1,000,000 SOL</span>
            </div>
            <div class="h-4 bg-[#13091B] rounded-full overflow-hidden gradient-border">
                <div class="h-full bg-gradient-to-r from-[#9945FF] to-[#14F195] rounded-full" style="width: 50%"></div>
            </div>
        </div>

        <!-- 投资表单 -->
        <div class="mb-6">
            <h3 class="text-[#9945FF] mb-2">投资金额 (SOL)</h3>
            <input type="text" 
                   id="investAmount" 
                   placeholder="输入 SOL 数量（最小 0.1）" 
                   class="w-full px-4 py-3 rounded-lg bg-[#13091B] gradient-border text-[#14F195] focus:outline-none"
                   pattern="[0-9]*[.]?[0-9]?"
                   inputmode="decimal"
                   autocomplete="off">
        </div>

        <div class="mb-6">
            <h3 class="text-[#9945FF] mb-2">将获得 DSNK</h3>
            <p class="text-2xl font-bold text-[#14F195]" id="dsnkAmount">0 DSNK</p>
        </div>

        <!-- 推荐奖励 -->
        <div class="gradient-border rounded-lg bg-[#13091B] p-4 mb-6">
            <h3 class="text-[#9945FF] mb-2">推荐奖励</h3>
            <p class="text-[#14F195] mb-2">分享您的推荐链接，获得被推荐人投资额的 10% SOL 奖励！</p>
            <div class="text-[#14F195]">
                推荐奖励: <span id="rewardAmount" class="bg-gradient-to-r from-[#9945FF] to-[#14F195] text-transparent bg-clip-text font-bold">0</span> SOL
            </div>
        </div>

        <!-- 按钮 -->
        <button id="connectWallet" onclick="connectWallet()" 
                class="w-full bg-gradient-to-r from-[#9945FF] to-[#14F195] text-white px-8 py-3 rounded-lg font-bold hover:opacity-90 transition-colors mb-4 wallet-connect-btn">
            连接钱包
        </button>

        <div id="contributeForm" class="hidden">
            <button id="contributeButton" onclick="contribute()"
                    class="w-full bg-gradient-to-r from-[#9945FF] to-[#14F195] text-white px-8 py-3 rounded-lg font-bold hover:opacity-90 transition-colors">
                投资
            </button>
        </div>
    </div>
</div>

<!-- 引入 Solana Web3.js -->
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

<script>
    // 配置
    const config = {
        PRESALE_END_DATE: '2025-01-31T00:00:00Z',
        SOFT_CAP: 1000,
        HARD_CAP: 2000,
        DSNK_PER_SOL: 10000,
        RPC_URL: 'https://api.mainnet-beta.solana.com',
        WALLET_ADDRESS: 'BcXV94bgVxk49Fj5NPBwbN1D9ffxMmm6P7JHnfBsdTJ9'
    };

    // 初始化变量
    let wallet = null;
    const PRESALE_END_DATE = new Date(config.PRESALE_END_DATE);
    
    const investAmountInput = document.getElementById('investAmount');

    // 输入事件监听器
    investAmountInput.addEventListener('input', function() {
        const amount = parseFloat(this.value) || 0;
        document.getElementById('rewardAmount').textContent = (amount * 0.1).toFixed(2);
        document.getElementById('dsnkAmount').textContent = (amount * config.DSNK_PER_SOL).toLocaleString() + ' DSNK';
    });

    // 连接钱包函数
    async function connectWallet() {
        try {
            if (!window.solana) {
                alert('请先安装 Phantom 钱包!');
                window.open('https://phantom.app/', '_blank');
                return;
            }

            const resp = await window.solana.connect();
            wallet = resp.publicKey.toString();
            
            // 更新UI
            const shortAddress = wallet.slice(0, 4) + '...' + wallet.slice(-4);
            document.querySelectorAll('.wallet-connect-btn').forEach(button => {
                button.textContent = shortAddress;
            });
            
            document.getElementById('contributeForm').classList.remove('hidden');
            document.getElementById('connectWallet').classList.add('hidden');

        } catch (err) {
            console.error('连接钱包失败:', err);
            alert('连接钱包失败: ' + err.message);
        }
    }

    // 投资函数
    async function contribute() {
        if (!wallet) {
            alert('请先连接钱包');
            return;
        }

        const amount = parseFloat(investAmountInput.value);
        if (isNaN(amount) || amount < 0.1) {
            alert('请输入有效的投资金额（最小 0.1 SOL）');
            return;
        }

        try {
            const connection = new solanaWeb3.Connection(config.RPC_URL);
            const transaction = new solanaWeb3.Transaction();
            
            transaction.add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: new solanaWeb3.PublicKey(wallet),
                    toPubkey: new solanaWeb3.PublicKey(config.WALLET_ADDRESS),
                    lamports: Math.floor(amount * solanaWeb3.LAMPORTS_PER_SOL)
                })
            );

            const { blockhash } = await connection.getLatestBlockhash();
            transaction.recentBlockhash = blockhash;
            transaction.feePayer = new solanaWeb3.PublicKey(wallet);

            const signed = await window.solana.signTransaction(transaction);
            const signature = await connection.sendRawTransaction(signed.serialize());
            
            await connection.confirmTransaction(signature);
            alert('投资成功！\n交易签名: ' + signature);
            investAmountInput.value = '';
            document.getElementById('dsnkAmount').textContent = '0 DSNK';
            document.getElementById('rewardAmount').textContent = '0';
            
        } catch (error) {
            console.error('投资失败:', error);
            alert(error.message);
        }
    }

    // 更新倒计时
    function updateCountdown() {
        const now = new Date().getTime();
        const distance = PRESALE_END_DATE - now;

        document.getElementById('days').textContent = String(Math.floor(distance / (1000 * 60 * 60 * 24))).padStart(2, '0');
        document.getElementById('hours').textContent = String(Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2, '0');
        document.getElementById('minutes').textContent = String(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
        document.getElementById('seconds').textContent = String(Math.floor((distance % (1000 * 60)) / 1000)).padStart(2, '0');
    }

    // 初始化
    updateCountdown();
    setInterval(updateCountdown, 1000);
</script>

</body>
</html>
